angular.module("selectionModel",[]),angular.module("selectionModel").directive("selectionModelIgnore",[function(){"use strict";return{restrict:"A",link:function(a,b,c){function d(){}function e(a){a.selectionModelIgnore=!0,a.originalEvent&&(a.originalEvent.selectionModelIgnore=!0)}function f(){(!c.selectionModelIgnore||a.$eval(c.selectionModelIgnore))&&e(event)}a.__tag=new d,b.on("click",f),a.$on("$destroy",function(){b.off("click",f)})}}}]),angular.module("selectionModel").directive("selectionModel",["selectionStack","uuidGen","selectionModelOptions",function(a,b,c){"use strict";return{restrict:"A",link:function(d,e,f){function g(){}d.__tag=new g;var h=c.get(),i=h.selectedAttribute,j=h.selectedClass,k=h.type,l=h.mode,m=h.cleanupStrategy,n=h.target,o=f.selectionModelType||k,p=f.selectionModelMode||l,q=/^multi(ple)?(-additive)?$/.test(p),r=/^multi(ple)?-additive/.test(p),s=f.selectionModelSelectedAttribute||i,t=f.selectionModelSelectedClass||j,u=f.selectionModelCleanupStrategy||m,v=f.selectionModelTarget||n,w=f.selectionModelOnChange,x=f.ngRepeat;if(!x)throw"selectionModel must be used along side ngRepeat";var y=d.$eval(f.selectionModelSelectedItems),z=function(){if(!q)return null;var a="data-selection-model-stack-id",c=e.attr(a);return c?c:(c=e.parent().attr(a))?(e.attr(a,c),c):(c=b.create(),e.attr(a,c),e.parent().attr(a,c),c)}(),A=x.split(" in "),B=d.$eval(A[0]),C=function(){if(B[s]?e.addClass(t):e.removeClass(t),"checkbox"===o){var a=e.find("input[type=checkbox]").eq(0);a.prop("checked",B[s])}},D=function(){return d.$eval(A[1])},E=function(){return d.$eval(A[1].split(/[|=]/)[0])},F=function(a){var b,c=angular.isArray(y),d=angular.isArray(a)&&2===a.length,e=E(),f=0,g=!1;c&&(y.length=0),angular.forEach(e,function(e){d?(b=a.indexOf(e),b>-1?(f++,g=!1,a.splice(b,1)):g=1!==f):g=e!==a,g?e[s]=!1:c&&e[s]&&y.push(e)})},G=function(a){var b=(D(),!1),c=!1;a=a||B,angular.forEach(D(),function(d){c=c||d===B,b=b||d===a;var e=b+c===1;(e||d===B||d===a)&&(d[s]=!0)})},H=function(b){if(!(b.selectionModelIgnore||b.originalEvent&&b.originalEvent.selectionModelIgnore||b.selectionModelClickHandled||b.originalEvent&&b.originalEvent.selectionModelClickHandled)){b.selectionModelClickHandled=!0,b.originalEvent&&(b.originalEvent.selectionModelClickHandled=!0);var c=b.ctrlKey||b.metaKey||r,f=b.shiftKey,g=b.target||b.srcElement,h="checkbox"===o&&"INPUT"===g.tagName&&"checkbox"===g.type;if("LABEL"===g.tagName){var i=angular.element(g).attr("for");if(i){var j,k=e[0].getElementsByTagName("INPUT");for(j=k.length;j--;)if(k[j].id===i)return}else if(g.getElementsByTagName("INPUT").length)return}if(f&&q)return c||d.$apply(function(){F([B,a.peek(z)])}),G(a.peek(z)),void d.$apply();if(c||f||h){var l=!B[s];return q||F(B),B[s]=l,B[s]&&a.push(z,B),void d.$apply()}F(B),d.$apply(),B[s]=!0,a.push(z,B),d.$apply()}},I=function(){if(angular.isArray(y)){var a=y.indexOf(B);B[s]?-1===a&&y.push(B):a>-1&&y.splice(a,1)}};if("checkbox"===v)e.find("input[type=checkbox]").eq(0).on("click",H);else if(e.on("click",H),"checkbox"===o){var J=e.find("input[type=checkbox]").eq(0);J[0]&&J.on("click",H)}C(),I(),"deselect"===u&&d.$on("$destroy",function(){var a=B[s];if(B[s]=!1,I(),w&&a&&d.$eval(w),"checkbox"===v)e.off("input[type=checkbox]").off("click",H);else if(e.off("click",H),"checkbox"===o){var b=e.find("input[type=checkbox]").eq(0);b[0]&&b.off("click",H)}}),d.$watch(A[0]+"."+s,function(a,b){a!==b&&(q||!a||b||(F(B),B[s]=!0),C(),I(),w&&d.$eval(w))})}}}]),angular.module("selectionModel").provider("selectionModelOptions",[function(){"use strict";var a={selectedAttribute:"selected",selectedClass:"selected",type:"basic",mode:"single",cleanupStrategy:"none",target:"element"};this.set=function(b){angular.extend(a,b)},this.$get=function(){var b={get:function(){return angular.copy(a)}};return b}}]),angular.module("selectionModel").service("selectionStack",function(){"use strict";var a={},b=1e3,c={};return a.push=function(a,d){c.hasOwnProperty(a)||(c[a]=[]);var e=c[a];for(e.push(d);e.length>b;)e.shift();return e.length},a.pop=function(a){c.hasOwnProperty(a)||(c[a]=[]);var b=c[a];return b.pop()},a.peek=function(a){c.hasOwnProperty(a)||(c[a]=[]);var b=c[a];return b.length?b[b.length-1]:void 0},a}),angular.module("selectionModel").service("uuidGen",function(){"use strict";var a={},b=["0","0","0"];return a.create=function(){for(var a,c=b.length;c;){if(c--,a=b[c].charCodeAt(0),57===a)return b[c]="A",b.join("");if(90!==a)return b[c]=String.fromCharCode(a+1),b.join("");b[c]="0"}return b.unshift("0"),b.join("")},a});